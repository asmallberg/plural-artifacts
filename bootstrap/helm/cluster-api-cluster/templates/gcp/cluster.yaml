{{- if and (eq .Values.provider "google") (eq .Values.type "managed") -}}
apiVersion: infrastructure.cluster.x-k8s.io/v1beta1
kind: GCPManagedCluster
metadata:
  name: {{ .Values.cluster.name }}
spec:
  project: {{ .Values.cluster.google.project }}
  region: {{ .Values.cluster.google.region }}
  controlPlaneEndpoint:
    host: ""
    port: 0
  network:
    name: {{ .Values.cluster.name }}-network
    {{ with .Values.cluster.google.network }}
    autoCreateSubnetworks: {{ .autoCreateSubnetworks }}
    {{ end }}
    subnets:
      {{ range .Values.cluster.google.subnets }}
      - name: {{ $.Values.cluster.name }}-{{ .nameSuffix }}
        region: {{ $.Values.cluster.google.region }}
        cidrBlock: {{ .cidrBlock }}
        description: {{ .description }}
        {{ with .secondaryCidrBlocks }}
        secondaryCidrBlocks: {{ . | toYaml | nindent 8 }}
        {{ end }}
        privateGoogleAccess: {{ .privateGoogleAccess }}
        enableFlowLogs: {{ .enableFlowLogs }}
        purpose: {{ .purpose }}
      {{ end }}
{{- end }}
