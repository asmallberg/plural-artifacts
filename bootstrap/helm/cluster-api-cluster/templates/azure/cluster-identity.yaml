{{- if and (eq .Values.provider "azure") (eq .Values.type "managed") -}}
kind: AzureClusterIdentity
apiVersion: infrastructure.cluster.x-k8s.io/v1beta1
metadata:
  name: {{ .Values.cluster.azure.clusterIdentityName }}
spec:
  type: {{ .Values.cluster.azure.clusterIdentityType }}
  {{- with .Values.cluster.azure.allowedNamespaces }}
  allowedNamespaces:
    {{- toYaml . | nindent 4 }}
  {{- end }}
  tenantID: {{ .Values.cluster.azure.tenantID }}
  clientID: {{ .Values.cluster.azure.clientID }}
  clientSecret:
  {{ if and .Values.cluster.azure.clientSecret .Values.cluster.azure.clientSecretName }}
    name: {{ .Values.cluster.azure.clientSecretName }}
    namespace: {{ .Release.Namespace }}
  {{ end }}
  resourceID: {{ .Values.cluster.azure.resourceID }}
{{- end }}
